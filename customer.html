<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body style="background: #f8f9fa;">
    <nav class="navbar">
        <div class="navbar-logo">
            <img src="https://cdn-icons-png.flaticon.com/512/3081/3081559.png" alt="ShopSpark Logo" height="36">
            <span style="font-weight:700;font-size:1.2rem;color:#667eea;letter-spacing:1px;">TechSpark</span>
        </div>
        <div class="navbar-menu">
            <a href="#">Home</a>
            <a href="#">Product</a>
            <a href="#">About us</a>
            <a href="#">FAQ</a>
        </div>
        <div class="navbar-search">
            <input type="text" placeholder="Search">
            <button class="navbar-signin" onclick="window.location.href='index.html'">Sign in</button>
        </div>
    </nav>
    <main class="dashboard-content" style="max-width:1400px;">
        <div class="section-title">Most Popular Products</div>
        <div class="product-grid" id="popularProducts">
            <!-- Products will be loaded here -->
        </div>
        <div class="section-title">Best Selling Products</div>
        <div class="product-grid" id="bestSellingProducts">
            <!-- Products will be loaded here -->
        </div>
        <div class="section-title">New arrivals</div>
        <div class="product-grid" id="newArrivals">
            <!-- Products will be loaded here -->
                </div>
    </main>

    <!-- Rating Modal -->
    <div id="ratingModal" class="rating-modal" style="display: none;">
        <div class="rating-modal-content">
            <div class="rating-modal-header">
                <h3>Rate Your Purchase</h3>
                <button class="close-btn" onclick="closeRatingModal()">&times;</button>
            </div>
            <div class="rating-modal-body">
                <div class="product-info-rating">
                    <img id="ratingProductImage" src="" alt="Product">
                    <div>
                        <h4 id="ratingProductName">Product Name</h4>
                        <p id="ratingProductPrice">Price</p>
                    </div>
                </div>
                
                <div class="rating-section">
                    <label>Your Rating:</label>
                    <div class="star-rating">
                        <span class="star" data-rating="1">☆</span>
                        <span class="star" data-rating="2">☆</span>
                        <span class="star" data-rating="3">☆</span>
                        <span class="star" data-rating="4">☆</span>
                        <span class="star" data-rating="5">☆</span>
            </div>
                    <p class="rating-text">Click on a star to rate</p>
                </div>
                
                <div class="review-section">
                    <label for="reviewComment">Your Review (Optional):</label>
                    <textarea id="reviewComment" rows="4" placeholder="Share your experience with this product..."></textarea>
            </div>
                
                <div class="rating-actions">
                    <button onclick="submitRating()" class="submit-rating-btn">Submit Rating</button>
                    <button onclick="closeRatingModal()" class="cancel-rating-btn">Cancel</button>
                </div>
            </div>
        </div>
                </div>

    <script src="auth.js"></script>
    <script>
        // Load products when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadAllProducts();
        });

        // Load all products from localStorage
        function loadAllProducts() {
            const products = JSON.parse(localStorage.getItem('products') || '[]');
            
            if (products.length === 0) {
                showNoProducts();
                return;
            }

            // Sort products by different criteria
            const popularProducts = [...products].sort((a, b) => b.price - a.price).slice(0, 4);
            const bestSellingProducts = [...products].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).slice(0, 4);
            const newArrivals = [...products].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)).slice(0, 4);

            // Display products in different sections
            displayProducts('popularProducts', popularProducts);
            displayProducts('bestSellingProducts', bestSellingProducts);
            displayProducts('newArrivals', newArrivals);
        }

        function displayProducts(containerId, products) {
            const container = document.getElementById(containerId);
            
            if (products.length === 0) {
                container.innerHTML = '<div class="no-products">No products available in this category</div>';
                return;
            }

            container.innerHTML = products.map(product => `
            <div class="product-card">
                    <img src="${product.photoData || product.image || 'https://via.placeholder.com/400x300?text=No+Image'}" 
                         alt="${product.name}" 
                         onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">
                    <div class="product-title">${product.name}</div>
                    <div class="product-price">$${product.price}</div>
                    <div class="product-desc">${product.description}</div>
                    <div class="product-category">${product.category}</div>
                <div class="product-actions">
                    <button class="buy-btn">Buy Now</button>
                    <button class="cart-btn">Add to cart</button>
                        <button class="rating-btn" onclick="openRatingModal(this.closest('.product-card'))">Rate Product</button>
            </div>
                </div>
            `).join('');
        }

        function showNoProducts() {
            const containers = ['popularProducts', 'bestSellingProducts', 'newArrivals'];
            containers.forEach(containerId => {
                const container = document.getElementById(containerId);
                container.innerHTML = `
                    <div class="no-products-message">
                        <h3>No Products Available</h3>
                        <p>Products will appear here once sellers add them to the marketplace.</p>
            </div>
                `;
            });
        }

        // Rating functionality
        let currentRating = 0;
        let currentProduct = null;

        function openRatingModal(productCard) {
            const productImage = productCard.querySelector('img').src;
            const productName = productCard.querySelector('.product-title').textContent;
            const productPrice = productCard.querySelector('.product-price').textContent;
            
            currentProduct = {
                id: Date.now().toString(),
                name: productName,
                price: productPrice,
                image: productImage,
                sellerId: 'seller123' // This would come from the actual product data
            };
            
            document.getElementById('ratingProductImage').src = productImage;
            document.getElementById('ratingProductName').textContent = productName;
            document.getElementById('ratingProductPrice').textContent = productPrice;
            
            document.getElementById('ratingModal').style.display = 'flex';
            resetRating();
        }

        function closeRatingModal() {
            document.getElementById('ratingModal').style.display = 'none';
            currentProduct = null;
            currentRating = 0;
        }

        function resetRating() {
            currentRating = 0;
            const stars = document.querySelectorAll('.star');
            stars.forEach(star => star.textContent = '☆');
            document.querySelector('.rating-text').textContent = 'Click on a star to rate';
            document.getElementById('reviewComment').value = '';
        }

        // Star rating functionality
        document.addEventListener('DOMContentLoaded', function() {
            const stars = document.querySelectorAll('.star');
            
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    setRating(rating);
                });
                
                star.addEventListener('mouseenter', function() {
                    const rating = parseInt(this.dataset.rating);
                    highlightStars(rating);
                });
            });
            
            const starContainer = document.querySelector('.star-rating');
            starContainer.addEventListener('mouseleave', function() {
                highlightStars(currentRating);
            });
        });

        function setRating(rating) {
            currentRating = rating;
            highlightStars(rating);
            
            const ratingTexts = [
                'Click on a star to rate',
                'Poor',
                'Fair',
                'Good',
                'Very Good',
                'Excellent'
            ];
            
            document.querySelector('.rating-text').textContent = ratingTexts[rating];
        }

        function highlightStars(rating) {
            const stars = document.querySelectorAll('.star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.textContent = '★';
                    star.style.color = '#ffd700';
                } else {
                    star.textContent = '☆';
                    star.style.color = '#ccc';
                }
            });
        }

        function submitRating() {
            if (currentRating === 0) {
                alert('Please select a rating before submitting.');
                return;
            }
            
            const currentUser = auth.getCurrentUser();
            if (!currentUser) {
                alert('Please log in to submit a rating.');
                return;
            }
            
            const ratingData = {
                id: Date.now().toString(),
                productId: currentProduct.id,
                productName: currentProduct.name,
                sellerId: currentProduct.sellerId,
                customerId: currentUser.id,
                customerName: currentUser.name || currentUser.email,
                rating: currentRating,
                comment: document.getElementById('reviewComment').value,
                date: new Date().toISOString()
            };
            
            // Save rating to localStorage
            const ratings = JSON.parse(localStorage.getItem('ratings') || '[]');
            ratings.push(ratingData);
            localStorage.setItem('ratings', JSON.stringify(ratings));
            
            alert('Thank you for your rating!');
            closeRatingModal();
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('ratingModal');
            if (event.target === modal) {
                closeRatingModal();
            }
        }

        // Refresh products when page becomes visible (in case new products were added)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadAllProducts();
            }
        });
    </script>
</body>
</html> 